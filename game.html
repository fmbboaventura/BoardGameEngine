<!DOCTYPE html>
<html lang="en">
<head>
  <title>Bootstrap Example</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="style/bootstrap.min.css">
  <link rel="stylesheet" href="style/index.css">
  <script src="js/jquery.min.js"></script>
  <script src="js/bootstrap.min.js"></script>
  <script src="js/phaser.min.js"></script>
  <script src="js/require.js"></script>
</head>
<body>

<nav class="navbar navbar-inverse">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
    </div>
    <div class="collapse navbar-collapse" id="myNavbar">
      <ul class="nav navbar-nav">
        <li class="active"><a href="index.html">Home</a></li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
      </ul>
    </div>
  </div>
</nav>

<div class="container-fluid text-center">
  <div class="row content">

    <!-- Left sidenav -->
    <div class="col-sm-2 sidenav">
      <div id="playerAttribute">
        <h4>Player Attributes</h4>
        <p>Prop1 = 0</p>
        <p>Prop2 = 0</p>
        <p>Prop3 = 0</p>
      </div>
    </div>

    <div class="col-sm-8 text-left">
      <div id="phaser-game"></div>
      <script type="text/javascript">

        function getGameIndex(){
          var urlString = window.location.href; //window.location.href
          var url = new URL(urlString);
          var gameIndex = parseInt(url.searchParams.get("select"));
          return gameIndex;
        }

        window.onload = function () {
          var gameState = "";

          var backgroundWidth = 0;
          var backgroundHeight = 0;
          var pawnWidth = 0;
          var pawnHeight = 0;

          var pawnSprite = {};

          var boardGameAdapter = require('./BoardGameAdapter.js');
          boardGameAdapter.setGameConfig("./"+boardGameAdapter.boardGameList[getGameIndex()]);
          boardGameAdapter.startGameStatus();

          var game = new Phaser.Game(800, 600, Phaser.AUTO, 'phaser-game', { preload: preload, create: create });

          function button1OnClick () {
            // var pawn = boardGameAdapter.getGameConfig("gameData").component.tokens[0];
            // var posId = pawn.positionId
            // var pos = boardGameAdapter.getGameConfig("gameData").board.positions[posId];
            // pos = boardGameAdapter.getGameConfig("gameData").board.positions[pos.next[0]];
            // pawn.positionId = pos.positionId;
            //
            // pawnSprite.x = backgroundWidth*pos.location[0]-(pawnWidth/2);
            // pawnSprite.y = backgroundHeight*pos.location[1]-(pawnHeight/2);
            // console.log("clicou: " + pawnSprite.x + " " + pawnSprite.y + " " + pos.positionType + " " + pos.positionId);
            // console.log(boardGameAdapter.getGameConfig("gameData").board.positions);
          }

          // Carregando as imagens do jogo
          function preload() {
            // TODO remover
            game.load.image('button1', 'button1.png');

            // Carregando tabuleiro
            game.load.image('background', boardGameAdapter.getGameConfig("boardBackground"));

            // Carregando icones dos atributos do jogador
            let attributeImg = boardGameAdapter.getGameConfig("playerAttributeImg");
            for (var attributeName in attributeImg) {
              if (attributeImg.hasOwnProperty(attributeName)) {
                game.load.image(attributeName +" "+ attributeImg[attributeName]);
              }
            }

            // Carregando icones dos tokens
            let tokenImg = boardGameAdapter.getGameConfig("tokenImg");
            for (var tokenType in tokenImg) {
              if (tokenImg.hasOwnProperty(tokenType)) {
                game.load.image(tokenType, tokenImg[tokenType]);
              }
            }
          }

          // Insere os componentes do jogo no mundo
          function create() {
            var backgroundImg = game.add.sprite(0, 0, 'background');
            backgroundWidth = backgroundImg.width;
            backgroundHeight = backgroundImg.height;

            let boardPositionList = boardGameAdapter.getGameStatus("boardPositionList");
            let playerStatus = boardGameAdapter.getGameStatus('playerStatus');

            for (var id in playerStatus) {
              if (playerStatus.hasOwnProperty(id)) {
                let tokens = playerStatus[id].tokens;

                for (var i = 0; i < tokens.length; i++) {
                  let position = boardPositionList[tokens[i].positionId];
                  game.add.sprite(
                    backgroundWidth*position.location[0],
                    backgroundHeight*position.location[1],
                    tokens[i].tokenType
                  ).anchor.set(0.5); // TODO: remover ancora (?)
                }
              }
            }

            // var posId = boardGameAdapter.getGameConfig("gameData").component.tokens[0].positionId
            // var pos = boardGameAdapter.getGameConfig("gameData").board.positions[posId];
            //
            // var backgroundImg = game.cache.getImage('background1');
            // backgroundWidth = backgroundImg.width;
            // backgroundHeight = backgroundImg.height;
            //
            // var pawnImg = game.cache.getImage('pawn');
            // pawnWidth = pawnImg.width;
            // pawnHeight = pawnImg.height;
            //
            // pawnSprite = game.add.sprite(
            //     backgroundWidth*pos.location[0]-(pawnWidth/2),
            //     backgroundHeight*pos.location[1]-(pawnHeight/2), 'pawn'
            // );

            game.add.button(50, 50, 'button1', button1OnClick);
          }

          function perform() {
            switch (gameState) {
              case "ready":

                break;
              default:

            }
          }

        }
      </script>
      <h3>Test</h3>
      <p>Lorem ipsum...</p>
    </div>

    <!-- Right sidenav -->
    <div class="col-sm-2 sidenav">
      <div id="actions">
        <h4>Available Actions</h4>
        <p><a href="#">Link</a></p>
        <p><a href="#">Link</a></p>
        <p><a href="#">Link</a></p>
      </div>
    </div>
  </div>
</div>

<footer class="container-fluid text-center">
  <p>Footer Text</p>
</footer>

</body>
</html>
